# 留言生成方案

**目标**
- 留言内容不放在环境变量中
- 可在本地与GitHub Actions一致运行
- 简单、稳定、可扩展

**生成模式**
- 网络抓取：优先从公共接口抓取每日随机文案（默认：`https://v1.hitokoto.cn/?encode=json`），自动拼接来源；网络不可用时降级
 - 网络抓取：优先从公共接口抓取每日随机文案（默认：`https://v1.hitokoto.cn/?encode=json`），自动在句尾追加作者与出处，例如：`永远不要熄灭心中的火 —— 佚名 · 网易云`；网络不可用时降级
- 列表随机：从 `content/messages.txt` 读取非空行，随机选一条
- 模板渲染：从 `content/templates.json` 读取模板数组，支持占位符：`{yyyy} {mm} {dd} {HH} {MM} {ss} {w}`（星期）
- 兜底模板：当上述文件不存在或为空时，使用内置模板：`早安~ 今天是{yyyy}-{mm}-{dd} 星期{w}`

**占位符说明**
- `yyyy`: 年，例如 `2025`
- `mm`: 月，2位，例如 `12`
- `dd`: 日，2位，例如 `02`
- `HH`: 小时，2位，例如 `07`
- `MM`: 分钟，2位
- `ss`: 秒，2位
- `w`: 星期，`日一二三四五六`

**文件结构**
- `content/messages.txt`：每行一条文案，支持中文和占位符
- `content/templates.json`：JSON数组，每个元素是字符串模板

**示例**
- `content/messages.txt`
```
早安，元气满满的一天开始啦
保持热爱，奔赴山海
愿你所念皆所愿，所行皆坦途
生活明朗，万物可爱
今日份打卡：{yyyy}-{mm}-{dd} 星期{w}
```

- `content/templates.json`
```json
[
  "早安~ 今天是{yyyy}-{mm}-{dd} 星期{w}",
  "{yyyy}年{mm}月{dd}日，新的开始，加油！",
  "打卡时间 {HH}:{MM}:{ss}，保持更新"
]
```

**集成方式**
- 已在 `scripts/qzone_msg.js` 集成生成器：优先网络抓取（可通过设置 `OFFLINE=1` 关闭），其次读取 `messages.txt`，再读取 `templates.json`，最后使用内置模板
- GitHub Actions 已移除 `MESSAGE` 环境变量，内容来源于网络或仓库文件

**运行说明**
- 本地：直接运行 `npm run qzone`
- 云端：工作流自动每日执行（北京时间 `07:00` 对应 UTC `23:00`）

**扩展建议**
- 分类文案：根据星期或日期选择不同文件
- 周期轮替：按天序号轮换而非随机，避免重复
- 接入API：如名言或天气（需考虑稳定性与时区），建议本地缓存到文件后再读取
